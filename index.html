<h1>Device Web API Test</h1>
<button type="button" onclick="onButtonClick()">requestPermission</button>
<h3>Output</h3>
<div id="output" class="output">
  <div id="window">
    <label>Orientation:<input type="text" class="orientation"/></label><br/>
  </div>
  <h2>device motion</h2>
  <div id="devicemotion">
    <label>Interval:</label><input type="text" class="interval"/><br/>
    <label>Timestamp:</label><input type="text" class="timeStamp"/><br/>
    <h3>acceleration</h3>
    <div id="acceleration">
      <label>X:</label><input type="text" class="x" style="text-align:right"/><br/>
      <label>Y:</label><input type="text" class="y" style="text-align:right"/><br/>
      <label>Z:</label><input type="text" class="z" style="text-align:right"/><br/>
    </div>
    <h3>acceleration including gravity</h3>
    <div id="accelerationIncludingGravity">
      <label>X:</label><input type="number" class="x"/><br/>
      <label>Y:</label><input type="number" class="y"/><br/>
      <label>Z:</label><input type="number" class="z"/><br/>
  </div>
  </div>
  <h2>device orienation</h2>
  <div id="deviceorientation">
    <label>Absolute:</label><input type="text" class="absolute" /><br/>
    <label>Timestamp:</label><input type="text" class="timeStamp"/><br/>
    <h3>rotation rate</h3>
    <div id="rotationRate">
      <label>ALPHA:</label><input type="text" class="alpha"/><br/>
      <label>BETA:</label><input type="text" class="beta"/><br/>
      <label>GAMMA:</label><input type="text" class="gamma"/><br/>
    </div>
  </div>
  <div id="compassneedcalibration">
    <label>Need Calibration:</label><input type="text" class="need"/><br/>
  </div>
  <div id="status"></div>
  <pre id="log"></pre>
</div>

<script>

function log(line) {
  document.querySelector('#log').textContent += line + '\n';
  console.log(line);
}

async function onDeviceMotion(event) {
  document.querySelector('#devicemotion > .interval' ).value  = event.interval.toFixed(6);
  document.querySelector('#devicemotion > .timeStamp').value = event.timeStamp;

  document.querySelector('#acceleration > .x').value = event.acceleration.x.toFixed(3);
  document.querySelector('#acceleration > .y').value = event.acceleration.y.toFixed(3);
  document.querySelector('#acceleration > .z').value = event.acceleration.z.toFixed(3);

  document.querySelector('#accelerationIncludingGravity > .x').value = event.accelerationIncludingGravity.x;
  document.querySelector('#accelerationIncludingGravity > .y').value = event.accelerationIncludingGravity.y;
  document.querySelector('#accelerationIncludingGravity > .z').value = event.accelerationIncludingGravity.z;

  document.querySelector('#window > .orientation').value = window.orientation;

  console.log(event);
}

async function onDeviceOrientation(event) {
  document.querySelector('#deviceorientation > .absolute' ).value  = event.absolute;
  document.querySelector('#deviceorientation > .timeStamp').value = event.timeStamp;

  document.querySelector('#rotationRate > .alpha').value = event.alpha;
  document.querySelector('#rotationRate > .beta' ).value  = event.beta;
  document.querySelector('#rotationRate > .gamma').value = event.gamma;
}

async function onCompassNeedCalibration(event) {
  document.querySelector('#compassneedcalibration > need').value = 'true';
}

async function onButtonClick() {
  try {
    if (DeviceMotionEvent.requestPermission) {
      const state = await DeviceMotionEvent.requestPermission();
      if (state === 'granted') {
        window.addEventListener("devicemotion", onDeviceMotion);
        window.addEventListener("deviceorientation", onDeviceOrientation);
        window.addEventListener("compassneedscalibration", onCompassNeedCalibration);
      } else {
        alert('not permitted!');
      }
    } 
  } catch (error) {
    log('Argh! ' + error);
    log(error.stack);
  }
}

</script>
